apiVersion: v1
kind: ConfigMap
metadata:
  name: oracle-db-configmap
data:
  init.sql: |-
    SELECT 'Oracle initialization complete' FROM dual;
  dki_01.sql: |-
    SELECT SYS_CONTEXT('USERENV', 'CON_NAME') AS CURRENT_CONTAINER FROM DUAL;
    ALTER SESSION SET CONTAINER = XEPDB1;

    CREATE USER dkuser IDENTIFIED BY dkpassword;
    GRANT CONNECT, RESOURCE TO dkuser;
    ALTER USER dkuser QUOTA UNLIMITED ON users;

    CREATE TABLE dkuser.eventos (
        id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        codigo VARCHAR2(125) NOT NULL,
        nombre VARCHAR2(255) NOT NULL,
        descripcion VARCHAR2(255) NOT NULL,
        fecha DATE NOT NULL,
        ubicacion VARCHAR2(255) NOT NULL,
        capacidad_max INT NOT NULL
    );

    CREATE TABLE dkuser.participantes (
        id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        id_evento NUMBER NOT NULL,
        dni VARCHAR2(8) NOT NULL,
        nombres_apellidos VARCHAR2(255) NOT NULL,
        fecha_registro DATETIME NOT NULL
    );

    ALTER TABLE dkuser.participantes
    ADD CONSTRAINT fk_participantes_eventos
    FOREIGN KEY (id_evento)
    REFERENCES dkuser.eventos(id);
  dki_02.sql: |-
    ALTER SESSION SET CONTAINER=CDB$ROOT;
    ALTER DATABASE OPEN;
    CREATE PLUGGABLE DATABASE XEPDB2 FROM XEPDB1;
    ALTER PLUGGABLE DATABASE XEPDB2 OPEN;